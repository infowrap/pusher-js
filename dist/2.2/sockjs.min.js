/* SockJS client, http://sockjs.org, MIT License
 *
 * Copyright (c) 2011-2012 VMware, Inc.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */

var JSON;JSON||(JSON={});
(function(){function p(c,n){var r,x,s,u,B=m,k,l=n[c];l&&"object"==typeof l&&"function"==typeof l.toJSON&&(l=l.toJSON(c));"function"==typeof w&&(l=w.call(n,c,l));switch(typeof l){case "string":return g(l);case "number":return isFinite(l)?String(l):"null";case "boolean":case "null":return String(l);case "object":if(!l)return"null";m+=A;k=[];if("[object Array]"===Object.prototype.toString.apply(l)){u=l.length;for(r=0;r<u;r+=1)k[r]=p(r,l)||"null";s=0===k.length?"[]":m?"[\n"+m+k.join(",\n"+m)+"\n"+B+"]":
"["+k.join(",")+"]";m=B;return s}if(w&&"object"==typeof w){u=w.length;for(r=0;r<u;r+=1)"string"==typeof w[r]&&(x=w[r],s=p(x,l),s&&k.push(g(x)+(m?": ":":")+s))}else for(x in l)Object.prototype.hasOwnProperty.call(l,x)&&(s=p(x,l),s&&k.push(g(x)+(m?": ":":")+s));s=0===k.length?"{}":m?"{\n"+m+k.join(",\n"+m)+"\n"+B+"}":"{"+k.join(",")+"}";m=B;return s}}function g(c){n.lastIndex=0;return n.test(c)?'"'+c.replace(n,function(c){var g=J[c];return"string"==typeof g?g:"\\u"+("0000"+c.charCodeAt(0).toString(16)).slice(-4)})+
'"':'"'+c+'"'}function c(c){return 10>c?"0"+c:c}"use strict";"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(g){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+c(this.getUTCMonth()+1)+"-"+c(this.getUTCDate())+"T"+c(this.getUTCHours())+":"+c(this.getUTCMinutes())+":"+c(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(c){return this.valueOf()});var u=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
n=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,m,A,J={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},w;"function"!=typeof JSON.stringify&&(JSON.stringify=function(c,g,r){var n;A=m="";if("number"==typeof r)for(n=0;n<r;n+=1)A+=" ";else"string"==typeof r&&(A=r);w=g;if(!g||"function"==typeof g||"object"==typeof g&&"number"==typeof g.length)return p("",{"":c});throw Error("JSON.stringify");});"function"!=
typeof JSON.parse&&(JSON.parse=function(c,g){function p(c,m){var n,k,l=c[m];if(l&&"object"==typeof l)for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(k=p(l,n),void 0!==k?l[n]=k:delete l[n]);return g.call(c,m,l)}var m;c=String(c);u.lastIndex=0;u.test(c)&&(c=c.replace(u,function(c){return"\\u"+("0000"+c.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(c.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return m=eval("("+c+")"),"function"==typeof g?p({"":m},""):m;throw new SyntaxError("JSON.parse");})})();
var SockJS=function(){var p=document,g=window,c={},u=function(){};u.prototype.addEventListener=function(a,b){this._listeners||(this._listeners={});a in this._listeners||(this._listeners[a]=[]);var d=this._listeners[a];-1===c.arrIndexOf(d,b)&&d.push(b)};u.prototype.removeEventListener=function(a,b){if(this._listeners&&a in this._listeners){var d=this._listeners[a],e=c.arrIndexOf(d,b);-1!==e&&(1<d.length?this._listeners[a]=d.slice(0,e).concat(d.slice(e+1)):delete this._listeners[a])}};u.prototype.dispatchEvent=
function(a){var b=a.type,d=Array.prototype.slice.call(arguments,0);this["on"+b]&&this["on"+b].apply(this,d);if(this._listeners&&b in this._listeners)for(var c=0;c<this._listeners[b].length;c++)this._listeners[b][c].apply(this,d)};var n=function(a,b){this.type=a;if("undefined"!==typeof b)for(var d in b)b.hasOwnProperty(d)&&(this[d]=b[d])};n.prototype.toString=function(){var a=[],b;for(b in this)if(this.hasOwnProperty(b)){var d=this[b];"function"===typeof d&&(d="[function]");a.push(b+"="+d)}return"SimpleEvent("+
a.join(", ")+")"};var m=function(a){this._events=a||[];this._listeners={}};m.prototype.emit=function(a){this._verifyType(a);if(!this._nuked){var b=Array.prototype.slice.call(arguments,1);this["on"+a]&&this["on"+a].apply(this,b);if(a in this._listeners)for(var d=0;d<this._listeners[a].length;d++)this._listeners[a][d].apply(this,b)}};m.prototype.on=function(a,b){this._verifyType(a);this._nuked||(a in this._listeners||(this._listeners[a]=[]),this._listeners[a].push(b))};m.prototype._verifyType=function(a){-1===
c.arrIndexOf(this._events,a)&&c.log("Event "+JSON.stringify(a)+" not listed "+JSON.stringify(this._events)+" in "+this)};m.prototype.nuke=function(){this._nuked=!0;for(var a=0;a<this._events.length;a++)delete this[this._events[a]];this._listeners={}};c.random_string=function(a,b){b=b||37;var d,c=[];for(d=0;d<a;d++)c.push("abcdefghijklmnopqrstuvwxyz0123456789_".substr(Math.floor(Math.random()*b),1));return c.join("")};c.random_number=function(a){return Math.floor(Math.random()*a)};c.random_number_string=
function(a){var b=(""+(a-1)).length;return(Array(b+1).join("0")+c.random_number(a)).slice(-b)};c.getOrigin=function(a){if(a.match(/^file:\/\//))return null;var b=a.match(/^(https?):\/\/([^\/:]+)(:([0-9]+))?/);a=b[1];var d=b[2];(b=b[4])||(b="https"===a?443:80);return a+"://"+d+":"+b};c.isSameOriginUrl=function(a,b){b||(b=g.location.href);return c.getOrigin(a)===c.getOrigin(b)};c.getParentDomain=function(a){return/^[0-9.]*$/.test(a)||/^\[/.test(a)||!/[.]/.test(a)?a:a.split(".").slice(1).join(".")};
c.objectExtend=function(a,b){for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);return a};c.polluteGlobalNamespace=function(){"_jp"in g||(g._jp={})};c.closeFrame=function(a,b){return"c"+JSON.stringify([a,b])};c.userSetCode=function(a){return 1E3===a||3E3<=a&&4999>=a};c.countRTO=function(a){return 100<a?3*a:a+200};c.log=function(){g.console&&(console.log&&console.log.apply)&&console.log.apply(console,arguments)};c.bind=function(a,b){return a.bind?a.bind(b):function(){return a.apply(b,arguments)}};c.flatUrl=
function(a){return-1===a.indexOf("?")&&-1===a.indexOf("#")};c.amendUrl=function(a){var b=p.location;if(!a)throw Error("Wrong url for SockJS");if(!c.flatUrl(a))throw Error("Only basic urls are supported in SockJS");0===a.indexOf("//")&&(a=b.protocol+a);0===a.indexOf("/")&&(a=b.protocol+"//"+b.host+a);return a=a.replace(/[/]+$/,"")};c.arrIndexOf=function(a,b){for(var d=0;d<a.length;d++)if(a[d]===b)return d;return-1};c.arrSkip=function(a,b){var d=c.arrIndexOf(a,b);return-1===d?a.slice():a.slice(0,d).concat(a.slice(d+
1))};c.isArray=Array.isArray||function(a){return 0<={}.toString.call(a).indexOf("Array")};c.delay=function(a,b){"function"===typeof a&&(b=a,a=0);return setTimeout(b,a)};var A=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,J={"\x00":"\\u0000","\u0001":"\\u0001","\u0002":"\\u0002","\u0003":"\\u0003","\u0004":"\\u0004","\u0005":"\\u0005","\u0006":"\\u0006","\u0007":"\\u0007","\b":"\\b","\t":"\\t","\n":"\\n","\x0B":"\\u000b",
"\f":"\\f","\r":"\\r","\u000e":"\\u000e","\u000f":"\\u000f","\u0010":"\\u0010","\u0011":"\\u0011","\u0012":"\\u0012","\u0013":"\\u0013","\u0014":"\\u0014","\u0015":"\\u0015","\u0016":"\\u0016","\u0017":"\\u0017","\u0018":"\\u0018","\u0019":"\\u0019","\u001a":"\\u001a","\u001b":"\\u001b","\u001c":"\\u001c","\u001d":"\\u001d","\u001e":"\\u001e","\u001f":"\\u001f",'"':'\\"',"\\":"\\\\","\u007f":"\\u007f","\u0080":"\\u0080","\u0081":"\\u0081","\u0082":"\\u0082","\u0083":"\\u0083","\u0084":"\\u0084","\u0085":"\\u0085",
"\u0086":"\\u0086","\u0087":"\\u0087","\u0088":"\\u0088","\u0089":"\\u0089","\u008a":"\\u008a","\u008b":"\\u008b","\u008c":"\\u008c","\u008d":"\\u008d","\u008e":"\\u008e","\u008f":"\\u008f","\u0090":"\\u0090","\u0091":"\\u0091","\u0092":"\\u0092","\u0093":"\\u0093","\u0094":"\\u0094","\u0095":"\\u0095","\u0096":"\\u0096","\u0097":"\\u0097","\u0098":"\\u0098","\u0099":"\\u0099","\u009a":"\\u009a","\u009b":"\\u009b","\u009c":"\\u009c","\u009d":"\\u009d","\u009e":"\\u009e","\u009f":"\\u009f","\u00ad":"\\u00ad",
"\u0600":"\\u0600","\u0601":"\\u0601","\u0602":"\\u0602","\u0603":"\\u0603","\u0604":"\\u0604","\u070f":"\\u070f","\u17b4":"\\u17b4","\u17b5":"\\u17b5","\u200c":"\\u200c","\u200d":"\\u200d","\u200e":"\\u200e","\u200f":"\\u200f","\u2028":"\\u2028","\u2029":"\\u2029","\u202a":"\\u202a","\u202b":"\\u202b","\u202c":"\\u202c","\u202d":"\\u202d","\u202e":"\\u202e","\u202f":"\\u202f","\u2060":"\\u2060","\u2061":"\\u2061","\u2062":"\\u2062","\u2063":"\\u2063","\u2064":"\\u2064","\u2065":"\\u2065","\u2066":"\\u2066",
"\u2067":"\\u2067","\u2068":"\\u2068","\u2069":"\\u2069","\u206a":"\\u206a","\u206b":"\\u206b","\u206c":"\\u206c","\u206d":"\\u206d","\u206e":"\\u206e","\u206f":"\\u206f","\ufeff":"\\ufeff","\ufff0":"\\ufff0","\ufff1":"\\ufff1","\ufff2":"\\ufff2","\ufff3":"\\ufff3","\ufff4":"\\ufff4","\ufff5":"\\ufff5","\ufff6":"\\ufff6","\ufff7":"\\ufff7","\ufff8":"\\ufff8","\ufff9":"\\ufff9","\ufffa":"\\ufffa","\ufffb":"\\ufffb","\ufffc":"\\ufffc","\ufffd":"\\ufffd","\ufffe":"\\ufffe","\uffff":"\\uffff"},w=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g,
H,R=JSON&&JSON.stringify||function(a){A.lastIndex=0;A.test(a)&&(a=a.replace(A,function(a){return J[a]}));return'"'+a+'"'},r=function(a){var b,d={},c=[];for(b=0;65536>b;b++)c.push(String.fromCharCode(b));a.lastIndex=0;c.join("").replace(a,function(a){d[a]="\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4);return""});a.lastIndex=0;return d};c.quote=function(a){a=R(a);w.lastIndex=0;if(!w.test(a))return a;H||(H=r(w));return a.replace(w,function(a){return H[a]})};var x="websocket xdr-streaming xhr-streaming iframe-eventsource iframe-htmlfile xdr-polling xhr-polling iframe-xhr-polling jsonp-polling".split(" ");
c.probeProtocols=function(a){for(var b={},d=0;d<x.length;d++){var c=x[d];b[c]=h[c]&&h[c].enabled(a)}return b};c.detectProtocols=function(a,b,d){var c={},f=[];b||(b=x);for(var t=0;t<b.length;t++){var h=b[t];c[h]=a[h]}var g=function(a){var b=a.shift();c[b]?f.push(b):0<a.length&&g(a)};!1!==d.websocket&&g(["websocket"]);c["xhr-streaming"]&&!d.null_origin?f.push("xhr-streaming"):c["xdr-streaming"]&&!d.cookie_needed&&!d.null_origin?f.push("xdr-streaming"):g(["iframe-eventsource","iframe-htmlfile"]);c["xhr-polling"]&&
!d.null_origin?f.push("xhr-polling"):c["xdr-polling"]&&!d.cookie_needed&&!d.null_origin?f.push("xdr-polling"):g(["iframe-xhr-polling","jsonp-polling"]);return f};c.defaultOptions=function(){return{devel:!1,debug:!1,protocols_whitelist:[],info:void 0,rtt:void 0,max_window_time:4E3,init_window_size:4096}};c.createHook=function(){var a="a"+c.random_string(8);if(!("_sockjs_global"in g)){var b={};g._sockjs_global=function(a){a in b||(b[a]={id:a,del:function(){delete b[a]}});return b[a]}}return g._sockjs_global(a)};
c.attachMessage=function(a){c.attachEvent("message",a)};c.attachEvent=function(a,b){"undefined"!==typeof g.addEventListener?g.addEventListener(a,b,!1):(p.attachEvent("on"+a,b),g.attachEvent("on"+a,b))};c.detachMessage=function(a){c.detachEvent("message",a)};c.detachEvent=function(a,b){"undefined"!==typeof g.addEventListener?g.removeEventListener(a,b,!1):(p.detachEvent("on"+a,b),g.detachEvent("on"+a,b))};var s={},I=!1,B=function(){for(var a in s)s[a](),delete s[a]};c.attachEvent("unload",function(){I||
(I=!0,B())});c.unload_add=function(a){var b=c.random_string(8);s[b]=a;I&&c.delay(B);return b};c.unload_del=function(a){a in s&&delete s[a]};c.createIframe=function(a,b){var d=p.createElement("iframe"),e,f,t=function(){clearTimeout(e);try{d.onload=null}catch(a){}d.onerror=null},h=function(){d&&(t(),setTimeout(function(){d&&d.parentNode.removeChild(d);d=null},0),c.unload_del(f))},g=function(a){d&&(h(),b(a))};d.src=a;d.style.display="none";d.style.position="absolute";d.onerror=function(){g("onerror")};
d.onload=function(){clearTimeout(e);e=setTimeout(function(){g("onload timeout")},2E3)};p.body.appendChild(d);e=setTimeout(function(){g("timeout")},15E3);f=c.unload_add(h);return{post:function(a,b){try{d&&d.contentWindow&&d.contentWindow.postMessage(a,b)}catch(c){}},cleanup:h,loaded:t}};c.createHtmlfile=function(a,b){var d=new ActiveXObject("htmlfile"),e,f,t,h=function(){clearTimeout(e)},k=function(){d&&(h(),c.unload_del(f),t.parentNode.removeChild(t),t=d=null,CollectGarbage())};d.open();d.write('<html><script>document.domain="'+
document.domain+'";\x3c/script></html>');d.close();d.parentWindow._jp=g._jp;var l=d.createElement("div");d.body.appendChild(l);t=d.createElement("iframe");l.appendChild(t);t.src=a;e=setTimeout(function(){d&&(k(),b("timeout"))},15E3);f=c.unload_add(k);return{post:function(a,b){try{t&&t.contentWindow&&t.contentWindow.postMessage(a,b)}catch(d){}},cleanup:k,loaded:h}};var k=function(){};k.prototype=new m(["chunk","finish"]);k.prototype._start=function(a,b,d,e){var f=this;try{f.xhr=new XMLHttpRequest}catch(t){}if(!f.xhr)try{f.xhr=
new g.ActiveXObject("Microsoft.XMLHTTP")}catch(h){}if(g.ActiveXObject||g.XDomainRequest)b+=(-1===b.indexOf("?")?"?":"&")+"t="+ +new Date;f.unload_ref=c.unload_add(function(){f._cleanup(!0)});try{f.xhr.open(a,b,!0)}catch(k){f.emit("finish",0,"");f._cleanup();return}if(!e||!e.no_credentials)f.xhr.withCredentials="true";if(e&&e.headers)for(var l in e.headers)f.xhr.setRequestHeader(l,e.headers[l]);f.xhr.onreadystatechange=function(){if(f.xhr){var a=f.xhr;switch(a.readyState){case 3:try{var b=a.status,
d=a.responseText}catch(c){}1223===b&&(b=204);d&&0<d.length&&f.emit("chunk",b,d);break;case 4:b=a.status,1223===b&&(b=204),f.emit("finish",b,a.responseText),f._cleanup(!1)}}};f.xhr.send(d)};k.prototype._cleanup=function(a){if(this.xhr){c.unload_del(this.unload_ref);this.xhr.onreadystatechange=function(){};if(a)try{this.xhr.abort()}catch(b){}this.unload_ref=this.xhr=null}};k.prototype.close=function(){this.nuke();this._cleanup(!0)};(c.XHRCorsObject=function(){var a=this,b=arguments;c.delay(function(){a._start.apply(a,
b)})}).prototype=new k;(c.XHRLocalObject=function(a,b,d){var e=this;c.delay(function(){e._start(a,b,d,{no_credentials:!0})})}).prototype=new k;k=c.XDRObject=function(a,b,d){var e=this;c.delay(function(){e._start(a,b,d)})};k.prototype=new m(["chunk","finish"]);k.prototype._start=function(a,b,d){var e=this,f=new XDomainRequest;b+=(-1===b.indexOf("?")?"?":"&")+"t="+ +new Date;var h=f.ontimeout=f.onerror=function(){e.emit("finish",0,"");e._cleanup(!1)};f.onprogress=function(){e.emit("chunk",200,f.responseText)};
f.onload=function(){e.emit("finish",200,f.responseText);e._cleanup(!1)};e.xdr=f;e.unload_ref=c.unload_add(function(){e._cleanup(!0)});try{e.xdr.open(a,b),e.xdr.send(d)}catch(g){h()}};k.prototype._cleanup=function(a){if(this.xdr){c.unload_del(this.unload_ref);this.xdr.ontimeout=this.xdr.onerror=this.xdr.onprogress=this.xdr.onload=null;if(a)try{this.xdr.abort()}catch(b){}this.unload_ref=this.xdr=null}};k.prototype.close=function(){this.nuke();this._cleanup(!0)};c.isXHRCorsCapable=function(a){a=a.match(/^(https?:)/)[0];
return g.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest?1:g.XDomainRequest&&p.domain&&p.location.protocol==a?2:v.enabled()?3:4};var l=function(a,b,d){var e=this;c.delay(function(){e._start(a,b,d)})};l.prototype=new m(["finish"]);l.prototype._start=function(a,b,d){var e=this;if(!("_send_form"in d)){var f=d._send_form=p.createElement("form"),h=d._send_area=p.createElement("textarea");h.name="d";f.style.display="none";f.style.position="absolute";f.method="POST";f.enctype="application/x-www-form-urlencoded";
f.acceptCharset="UTF-8";f.appendChild(h);p.body.appendChild(f)}f=d._send_form;h=d._send_area;d="a"+c.random_string(8);e.area=h;f.target=d;f.action=a+"/jsonp_send?i="+d;var g;try{g=p.createElement('<iframe name="'+d+'">')}catch(k){g=p.createElement("iframe"),g.name=d}e.iframe=g;g.id=d;f.appendChild(g);g.style.display="none";try{h.value=b}catch(l){c.log("Your browser is seriously broken. Go home! "+l.message)}f.submit();var m=function(a){e.iframe&&(e._cleanup(),e.emit("finish"))};g.onerror=g.onload=
m;g.onreadystatechange=function(a){"complete"==g.readyState&&m()}};l.prototype._cleanup=function(){if(this.iframe){var a=this.iframe;this.area.value="";this.iframe.onreadystatechange=this.iframe.onerror=this.iframe.onload=this.area=null;this.iframe="";c.delay(500,function(){a.parentNode.removeChild(a);a=null})}};l.prototype.close=function(){this.nuke();this._cleanup()};var h=function(a,b,d){if(this===g)return new h(a,b,d);var e=this,f;e._options=c.defaultOptions();d&&c.objectExtend(e._options,d);
e._base_url=c.amendUrl(a);e._server=e._options.server||c.random_number_string(1E3);e._bus=new m(["close","heartbeat","message"]);e._options.protocols_whitelist&&e._options.protocols_whitelist.length?f=e._options.protocols_whitelist:(f="string"===typeof b&&0<b.length?[b]:c.isArray(b)?b:null)&&e._debug('Deprecated API: Use "protocols_whitelist" option instead of supplying protocol list as a second parameter to SockJS constructor.');e._protocols=[];e.protocol=null;e.readyState=h.CONNECTING;e._ir=S(e,
e._base_url);e._ir.onfinish=function(a,b){e._ir=null;a?(e._options.info&&(a=c.objectExtend(a,e._options.info)),e._options.rtt&&(b=e._options.rtt),e._applyInfo(a,b,f),e._didClose(void 0,void 0,void 0,"info-onfinish")):e._didClose(1002,"Can't connect to server",!0,"info-failed")}};h.prototype=new u;h.version="0.3.4.65.g83db";h.CONNECTING=0;h.OPEN=1;h.CLOSING=2;h.CLOSED=3;h.prototype._debug=function(){this._options.debug&&c.log.apply(c,arguments)};h.prototype._dispatchOpen=function(){if(this.readyState===
h.CONNECTING){this._transport_tref&&(clearTimeout(this._transport_tref),this._transport_tref=null);this.readyState=h.OPEN;var a=this._options.info.server_heartbeat_interval;a&&this._startHeartbeats(a);this.dispatchEvent(new n("open"))}else this._didClose(1006,"Server lost session",void 0,"_dispatchOpen")};h.prototype._dispatchMessage=function(a){this.readyState===h.OPEN&&(this._bus.emit("message",a),this.dispatchEvent(new n("message",{data:a})))};h.prototype._dispatchHeartbeat=function(a){this.readyState===
h.OPEN&&(this._bus.emit("heartbeat",a),this.dispatchEvent(new n("heartbeat",{flavour:a})))};h.prototype._didClose=function(a,b,d,e){var f=this;if(!(f.readyState!==h.CONNECTING&&f.readyState!==h.OPEN&&f.readyState!==h.CLOSING)){f._ir&&(f._ir.nuke(),f._ir=null);f._transport&&(f._transport.doCleanup(),f._transport=null);var g=new n("close",{code:a,reason:b,wasClean:c.userSetCode(a)});if(!c.userSetCode(a)&&f.readyState===h.CONNECTING&&!d){if(f._try_next_protocol(g))return;g=new n("close",{code:2E3,reason:"All transports failed",
wasClean:!1,last_event:g})}f.readyState=h.CLOSED;f._bus.emit("close");c.delay(function(){f.dispatchEvent(g)})}};h.prototype._didMessage=function(a){switch(a.slice(0,1)){case "o":this._dispatchOpen();break;case "a":a=JSON.parse(a.slice(1)||"[]");for(var b=0;b<a.length;b++)this._dispatchMessage(a[b]);0===a.length&&this._dispatchHeartbeat("recv");break;case "m":a=JSON.parse(a.slice(1)||"null");this._dispatchMessage(a);break;case "c":a=JSON.parse(a.slice(1)||"[]");this._didClose(a[0],a[1],void 0,"_didMessage");
break;case "h":this._dispatchHeartbeat("send")}};h.prototype._try_next_protocol=function(a){var b=this;b.protocol&&(b._debug("Closed transport:",b.protocol,""+a),b.protocol=null);b._transport_tref&&(clearTimeout(b._transport_tref),b._transport_tref=null);for(;;){a=b.protocol=b._protocols.shift();if(!a)return!1;if(h[a]&&!0===h[a].need_body&&(!p.body||"undefined"!==typeof p.readyState&&"complete"!==p.readyState))return b._protocols.unshift(a),b.protocol="waiting-for-load",c.attachEvent("load",function(){b._try_next_protocol()}),
!0;if(!h[a]||!h[a].enabled(b._base_url))b._debug("Skipping transport:",a);else{b._transport_tref=c.delay((b._options.rto||0)*(h[a].roundTrips||1)||5E3,function(){b.readyState===h.CONNECTING&&b._didClose(2007,"Transport timeouted")});var d=c.random_string(8),d=b._base_url+"/"+b._server+"/"+d;b._debug("Opening transport:",a," url:"+d," RTO:"+b._options.rto);b._transport=new h[a](b,d,b._base_url);return!0}}};h.prototype.close=function(a,b){if(a&&!c.userSetCode(a))throw Error("INVALID_ACCESS_ERR");if(this.readyState!==
h.CONNECTING&&this.readyState!==h.OPEN)return!1;this.readyState=h.CLOSING;this._didClose(a||1E3,b||"Normal closure",void 0,"close");return!0};h.prototype.send=function(a){if(this.readyState===h.CONNECTING)throw Error("INVALID_STATE_ERR");this.readyState===h.OPEN&&this._transport.doSend(c.quote(""+a));return!0};h.prototype._sendEmpty=function(){this.readyState===h.OPEN&&this._transport.doSend("");return!0};h.prototype._applyInfo=function(a,b,d){this._options.info=a;this._options.rtt=b;this._options.rto=
c.countRTO(b);this._options.info.null_origin=Boolean(this._options.ignore_null_origin||!p.domain);b=c.probeProtocols(this._base_url);this._protocols=c.detectProtocols(b,d,a);a.hostname&&(d=/(https?:\/\/)([^\/:]+)((\/|:)?.*)/.exec(this._base_url),this._base_url=d[1]+a.hostname+d[3])};k=h.websocket=function(a,b){var d=this,e=b+"/websocket",e="https"===e.slice(0,5)?"wss"+e.slice(5):"ws"+e.slice(4);d.ri=a;d.url=e;d.ws=new (g.WebSocket||g.MozWebSocket)(d.url);d.ws.onmessage=function(a){d.ri._didMessage(a.data)};
d.unload_ref=c.unload_add(function(){d.ws.close()});d.ws.onclose=function(){d.ri._didMessage(c.closeFrame(1006,"WebSocket connection broken"))}};k.prototype.doSend=function(a){this.ws.send("["+a+"]")};k.prototype.doCleanup=function(){var a=this.ws;a&&(a.onmessage=a.onclose=null,a.close(),c.unload_del(this.unload_ref),this.unload_ref=this.ri=this.ws=null)};k.enabled=function(){return!(!g.WebSocket&&!g.MozWebSocket)};k.roundTrips=2;var q=function(){};q.prototype.send_constructor=function(a){this.send_buffer=
[];this.sender=a;this.window_size=this.init_window_size=this.ri._options.init_window_size;this.max_window_time=this.ri._options.max_window_time};q.prototype.doSend=function(a){0<a.length&&this.send_buffer.push(a);this.send_stop&&0==a.length&&this.ri._debug("Attempting to send a heartbeat, but sending previous messages is still in progress.");this.send_stop||this.send_schedule()};q.prototype.adjustWindow=function(a,b){return a>this.max_window_time?(this.window_size=Math.max(this.window_size/2,this.init_window_size),
!0):b?(this.window_size=2*a<this.max_window_time?2*this.window_size:1.1*this.window_size,!0):!1};q.prototype.send_schedule_wait=function(){var a=this,b;a.send_stop=function(){a.send_stop=null;clearTimeout(b)};b=c.delay(25,function(){a.send_stop=null;0<a.send_buffer.length&&a.send_schedule()})};q.prototype.send_schedule=function(){var a=this,b=+new Date,d,c=2,f=!1;for(d=0;d<a.send_buffer.length;d++)if(c+=a.send_buffer[d].length+1,c>a.window_size){f=!0;break}d="["+a.send_buffer.splice(0,d).join(",")+
"]";a.send_stop=a.sender(a.trans_url,d,function(d,c){a.send_stop=null;!1===d?a.ri._didClose(1006,"Sending error "+c):(a.adjustWindow(+new Date-b,f)&&a.ri._debug("window_size adjusted: "+a.window_size),a.send_schedule_wait())})};q.prototype.send_destructor=function(){this.send_stop&&this.send_stop();this.send_stop=null};var T=function(a,b,d){var c=new l(a,b,this);c.onfinish=function(){d(!0)};return function(){c.close()}},U=function(a){return function(b,d,c){var f=new a("POST",b+"/xhr_send",d);f.onfinish=
function(a,b){c(200===a||204===a,"http status "+a)};return function(a){f.close()}}},V=function(a,b){var d,e=p.createElement("script"),f,g=function(a){f&&(f.parentNode.removeChild(f),f=null);e&&(clearTimeout(d),e.parentNode.removeChild(e),e=e.onreadystatechange=e.onerror=e.onload=e.onclick=null,b(a),b=null)},h=!1,k=null;e.id="a"+c.random_string(8);e.src=a;e.type="text/javascript";e.charset="UTF-8";e.onerror=function(a){k||(k=setTimeout(function(){h||g(c.closeFrame(1006,"JSONP script loaded abnormally (onerror)"))},
1E3))};e.onload=function(a){g(c.closeFrame(1006,"JSONP script loaded abnormally (onload)"))};e.onreadystatechange=function(a){if(/loaded|closed/.test(e.readyState)){if(e&&e.htmlFor&&e.onclick){h=!0;try{e.onclick()}catch(b){}}e&&g(c.closeFrame(1006,"JSONP script loaded abnormally (onreadystatechange)"))}};if("undefined"===typeof e.async&&p.attachEvent)if(/opera/i.test(navigator.userAgent))f=p.createElement("script"),f.text="try{var a = document.getElementById('"+e.id+"'); if(a)a.onerror();}catch(x){};",
e.async=f.async=!1;else{try{e.htmlFor=e.id,e.event="onclick"}catch(l){}e.async=!0}"undefined"!==typeof e.async&&(e.async=!0);d=setTimeout(function(){g(c.closeFrame(1006,"JSONP script loaded abnormally (timeout)"))},35E3);var m=p.getElementsByTagName("head")[0];m.insertBefore(e,m.firstChild);f&&m.insertBefore(f,m.firstChild);return g},k=h["jsonp-polling"]=function(a,b){c.polluteGlobalNamespace();this.ri=a;this.trans_url=b;this.send_constructor(T);this._schedule_recv()};k.prototype=new q;k.prototype._schedule_recv=
function(){var a=this;a._recv_stop=W(a.trans_url+"/jsonp",V,function(b){a._recv_stop=null;b&&(a._is_closing||a.ri._didMessage(b));a._is_closing||a._schedule_recv()})};k.enabled=function(){return!0};k.need_body=!0;k.polling=!0;k.prototype.doCleanup=function(){this._is_closing=!0;this._recv_stop&&this._recv_stop();this.ri=this._recv_stop=null;this.send_destructor()};var W=function(a,b,d){var e="a"+c.random_string(6);a=a+"?c="+escape("_jp."+e);var f=0;b=b(a,function(a){switch(f){case 0:delete g._jp[e];
d(a);break;case 1:d(a);f=2;break;case 2:delete g._jp[e]}});g._jp[e]=b;return function(){g._jp[e]&&(f=1,g._jp[e](c.closeFrame(1E3,"JSONP user aborted read")))}},k=function(){};k.prototype=new q;k.prototype.run=function(a,b,c,e,f){this.ri=a;this.trans_url=b;this.send_constructor(U(f));this.poll=new K(a,e,b+c,f)};k.prototype.doCleanup=function(){this.poll&&(this.poll.abort(),this.poll=null);this.send_destructor()};var z=h["xhr-streaming"]=function(a,b){this.run(a,b,"/xhr_streaming",C,c.XHRCorsObject)};
z.prototype=new k;z.enabled=function(){return g.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest&&!/opera/i.test(navigator.userAgent)};z.roundTrips=2;z.need_body=!0;q=h["xdr-streaming"]=function(a,b){this.run(a,b,"/xhr_streaming",C,c.XDRObject)};q.prototype=new k;q.enabled=function(a){return 2===c.isXHRCorsCapable(a)};q.roundTrips=2;var F=h["xhr-polling"]=function(a,b){this.run(a,b,"/xhr",C,c.XHRCorsObject)};F.prototype=new k;F.enabled=z.enabled;F.roundTrips=2;F.polling=!0;z=h["xdr-polling"]=
function(a,b){this.run(a,b,"/xhr",C,c.XDRObject)};z.prototype=new k;z.enabled=q.enabled;z.roundTrips=2;z.polling=!0;var v=function(){};v.prototype.i_constructor=function(a,b,d){var e=this;e.ri=a;e.origin=c.getOrigin(d);e.base_url=d;e.trans_url=b;a=d+"/iframe.html";b=[];e.ri._options.devel&&b.push("t="+ +new Date);e.ri._options.js_path&&b.push("js_path="+encodeURIComponent(e.ri._options.js_path));0<b.length&&(a+="?"+b.join("&"));e.window_id=c.random_string(8);a+="#"+e.window_id;e.iframeObj=c.createIframe(a,
function(a){e.ri._didClose(1006,"Unable to load an iframe ("+a+")")});e.onmessage_cb=c.bind(e.onmessage,e);c.attachMessage(e.onmessage_cb)};v.prototype.doCleanup=function(){if(this.iframeObj){c.detachMessage(this.onmessage_cb);try{this.iframeObj.iframe.contentWindow&&this.postMessage("c")}catch(a){}this.iframeObj.cleanup();this.onmessage_cb=this.iframeObj=this.iframeObj=null}};v.prototype.onmessage=function(a){if(c.getOrigin(a.origin)===c.getOrigin(this.origin)){var b=a.data.slice(0,8),d=a.data.slice(8,
9);a=a.data.slice(9);if(b===this.window_id)switch(d){case "s":this.iframeObj.loaded();this.postMessage("s",JSON.stringify([h.version,this.protocol,this.trans_url,this.base_url,this.ri._options]));break;case "t":this.ri._didMessage(a)}}};v.prototype.postMessage=function(a,b){this.iframeObj.post(this.window_id+a+(b||""),this.origin)};v.prototype.doSend=function(a){this.postMessage("m",a)};v.enabled=function(){var a=navigator&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Konqueror");return("function"===
typeof g.postMessage||"object"===typeof g.postMessage)&&!a};var L,M=function(a,b){parent!==g?parent.postMessage(L+a+(b||""),"*"):c.log("Can't postMessage, no parent window.",a,b)},y=function(a){this._options=a||c.defaultOptions()};y.prototype._didClose=function(a,b){M("t",c.closeFrame(a,b))};y.prototype._didMessage=function(a){M("t",a)};y.prototype._doSend=function(a){this._transport.doSend(a)};y.prototype._doCleanup=function(){this._transport.doCleanup()};y.prototype._debug=function(){c.log.apply(c,
arguments)};c.parent_origin=void 0;h.bootstrap_iframe=function(){var a;L=p.location.hash.slice(1);c.attachMessage(function(b){if(b.source===parent&&("undefined"===typeof c.parent_origin&&(c.parent_origin=b.origin),b.origin===c.parent_origin)){var d=b.data.slice(0,8),e=b.data.slice(8,9);b=b.data.slice(9);if(d===L)switch(e){case "s":var f=JSON.parse(b),d=f[0],e=f[1];b=f[2];var k=f[3],f=f[4];d!==h.version&&c.log("Incompatibile SockJS! Main site uses: "+d+", the iframe: "+h.version+". Double check SockJS urls and flush browser cache.");
if(!c.flatUrl(b)||!c.flatUrl(k)){c.log("Only basic urls are supported in SockJS");break}if(!c.isSameOriginUrl(b)||!c.isSameOriginUrl(k)){c.log("Can't connect to different domain from within an iframe. ("+JSON.stringify([g.location.href,b,k])+")");break}a=new y(f);a._transport=new y[e](a,b,k);break;case "m":a._doSend(b);break;case "c":a&&a._doCleanup(),a=null}}});M("s")};var D=function(a,b){var d=this;c.delay(function(){d.doXhr(a,b)})};D.prototype=new m(["finish"]);D.prototype.doXhr=function(a,b){var d=
this,e=(new Date).getTime(),f=new b("GET",a+"/info"),g=c.delay(8E3,function(){f.ontimeout()});f.onfinish=function(a,b){clearTimeout(g);g=null;if(200===a){var c=(new Date).getTime()-e,f=JSON.parse(b);"object"!==typeof f&&(f={});d.emit("finish",f,c)}else d.emit("finish")};f.ontimeout=function(){f.close();d.emit("finish")}};var P=function(a,b){var d=this,e=function(){var c=new v;c.protocol="w-iframe-info-receiver";var e=function(a){"string"===typeof a&&"m"===a.substr(0,1)?(a=JSON.parse(a.substr(1)),
d.emit("finish",a[0],a[1])):d.emit("finish");c.doCleanup();c=null};c.i_constructor({_options:{js_path:a._options.js_path},_didClose:e,_didMessage:e},b,b)};p.body?e():c.attachEvent("load",e)};P.prototype=new m(["finish"]);var Q=function(){var a=this;c.delay(function(){a.emit("finish",{},2E3)})};Q.prototype=new m(["finish"]);var S=function(a,b){if(c.isSameOriginUrl(b))return new D(b,c.XHRLocalObject);switch(c.isXHRCorsCapable(b)){case 1:return new D(b,c.XHRLocalObject);case 2:return new D(b,c.XDRObject);
case 3:return new P(a,b);default:return new Q}};(y["w-iframe-info-receiver"]=function(a,b,d){(new D(d,c.XHRLocalObject)).onfinish=function(b,c){a._didMessage("m"+JSON.stringify([b,c]));a._didClose(void 0,void 0,void 0,"w-iframe-info-receiver")}}).prototype.doCleanup=function(){};q=h["iframe-eventsource"]=function(){this.protocol="w-iframe-eventsource";this.i_constructor.apply(this,arguments)};q.prototype=new v;q.enabled=function(){return"EventSource"in g&&v.enabled()};q.need_body=!0;q.roundTrips=
3;(y["w-iframe-eventsource"]=function(a,b){this.run(a,b,"/eventsource",N,c.XHRLocalObject)}).prototype=new k;q=h["iframe-xhr-polling"]=function(){this.protocol="w-iframe-xhr-polling";this.i_constructor.apply(this,arguments)};q.prototype=new v;q.enabled=function(){return g.XMLHttpRequest&&v.enabled()};q.need_body=!0;q.roundTrips=3;(y["w-iframe-xhr-polling"]=function(a,b){this.run(a,b,"/xhr",C,c.XHRLocalObject)}).prototype=new k;q=h["iframe-htmlfile"]=function(){this.protocol="w-iframe-htmlfile";this.i_constructor.apply(this,
arguments)};q.prototype=new v;q.enabled=function(){return v.enabled()};q.need_body=!0;q.roundTrips=3;(y["w-iframe-htmlfile"]=function(a,b){this.run(a,b,"/htmlfile",O,c.XHRLocalObject)}).prototype=new k;var K=function(a,b,c,e){this.ri=a;this.Receiver=b;this.recv_url=c;this.AjaxObject=e;this._scheduleRecv()};K.prototype._scheduleRecv=function(){var a=this,b=a.poll=new a.Receiver(a.recv_url,a.AjaxObject);b.onmessage=function(b){a.ri._didMessage(b.data)};b.onclose=function(c){a.poll=b=b.onmessage=b.onclose=
null;a.poll_is_closing||("permanent"===c.reason?a.ri._didClose(1006,"Polling error ("+c.reason+")"):a._scheduleRecv())}};K.prototype.abort=function(){this.poll_is_closing=!0;this.poll&&this.poll.abort()};var N=function(a){var b=this,d=new EventSource(a);d.onmessage=function(a){b.dispatchEvent(new n("message",{data:unescape(a.data)}))};b.es_close=d.onerror=function(a,f){var g=f?"user":2!==d.readyState?"network":"permanent";b.es_close=d.onmessage=d.onerror=null;d.close();d=null;c.delay(200,function(){b.dispatchEvent(new n("close",
{reason:g}))})}};N.prototype=new u;N.prototype.abort=function(){this.es_close&&this.es_close({},!0)};var G,O=function(a){var b=this;c.polluteGlobalNamespace();b.id="a"+c.random_string(6,26);a+=(-1===a.indexOf("?")?"?":"&")+"c="+escape("_jp."+b.id);if(void 0===G)if("ActiveXObject"in g)try{G=!!new ActiveXObject("htmlfile")}catch(d){}else G=!1;var e=G?c.createHtmlfile:c.createIframe,f;g._jp[b.id]={start:function(){f.loaded()},message:function(a){b.dispatchEvent(new n("message",{data:a}))},stop:function(){b.iframe_close({},
"network")}};b.iframe_close=function(a,c){f.cleanup();b.iframe_close=f=null;delete g._jp[b.id];b.dispatchEvent(new n("close",{reason:c}))};f=e(a,function(a){b.iframe_close({},"permanent")})};O.prototype=new u;O.prototype.abort=function(){this.iframe_close&&this.iframe_close({},"user")};var C=function(a,b){var c=this,e=0;c.xo=new b("POST",a,null);c.xo.onchunk=function(a,b){if(200===a)for(;;){var g=b.slice(e),h=g.indexOf("\n");if(-1===h)break;e+=h+1;g=g.slice(0,h);c.dispatchEvent(new n("message",{data:g}))}};
c.xo.onfinish=function(a,b){c.xo.onchunk(a,b);c.xo=null;c.dispatchEvent(new n("close",{reason:200===a?"network":"permanent"}))}};C.prototype=new u;C.prototype.abort=function(){this.xo&&(this.xo.close(),this.dispatchEvent(new n("close",{reason:"user"})),this.xo=null)};h.getUtils=function(){return c};h.getIframeTransport=function(){return v};var E=function(a,b){var c=this;c.timeout=a;c.not_poked=0;c._onTimeout=function(){c.not_poked+=1;c.not_poked===b&&c.emit("timeout");c._restartTimeout()};c._restartTimeout()};
E.prototype=new m(["first","second","timeout"]);E.prototype.poke=function(){this.not_poked=0;this._restartTimeout()};E.prototype.close=function(){clearTimeout(this.tref)};E.prototype._restartTimeout=function(){this.tref&&clearTimeout(this.tref);this.tref=setTimeout(this._onTimeout,this.timeout)};h.prototype._startHeartbeats=function(a){var b=this;b._heartbeater=new E(a,2);b._bus.on("heartbeat",function(){h[b.protocol].polling||b._sendEmpty()});b._heartbeater.ontimeout=function(){b._didClose(1007,
"Server heartbeat missed")};a=function(){b._heartbeater.poke()};b._bus.on("heartbeat",a);b._bus.on("message",a);b._bus.on("close",function(){b._heartbeater.nuke();b._heartbeater.close()})};return h}();"_sockjs_onload"in window&&setTimeout(_sockjs_onload,1);"function"===typeof define&&define.amd&&define("sockjs",[],function(){return SockJS});"object"===typeof module&&(module&&module.exports)&&(module.exports=SockJS);
